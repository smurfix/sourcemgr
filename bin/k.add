#!/bin/sh

if test -z "$1" -o -n "$2"; then
	echo "Usage: $0 KERNEL" >&2
	exit 2
fi

K="$1"
set -ex
#cp /smurf/rh-72/boot/linux-$K /boot/
#cp -r /smurf/rh-72/lib/modules/$K /lib/modules
NK=$(cat /boot/grub/grub.conf | grep "^title" | wc -l | sed -e 's/[ \t]*//')
cat <<END >>/boot/grub/grub.conf
title $K (alt)
	root (hd0,0)
	kernel /boot/linux-$K ro root=/dev/hda1
END
perl -pi -e"s/^default=\\d+/default=$NK/" /boot/grub/grub.conf

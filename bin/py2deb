#!/bin/sh -ex

test -f setup.py
test ! -e debian
rm -rf deb_dist
python3 setup.py --command-packages=stdeb.command debianize --suite smurf --maintainer "Matthias Urlichs <matthias@urlichs.de>" "$@"

cat >debian/.gitignore <<_
/files
/*.log
/*.debhelper
/*.debhelper-build-stamp
/*.substvars
/debhelper-build-stamp
_
echo 13 >debian/compat
sed -ne 's#^Package: #/#p' <debian/control >>debian/.gitignore
sed -ne 's#buildsystem=.*#buildsystem=pybuild#'
uniq < debian/control > /tmp/x && mv /tmp/x debian/control

fgrep -qs .pybuild .gitignore || echo '/.pybuild/' >>.gitignore	
git add debian .gitignore
git commit -m "Debianized."
echo DONE
